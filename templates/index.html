{% extends "layout.html" %}

{%block content%}
    <h1>Información en Tiempo Real</h1>

    <div id="num_ues">
    </div>

    <div id="UEs">
        <p>UE conectado con la siguiente informacion:</p>
        <ul id="informacion">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
        </ul>        
    </div>
    
    <button type="button" onclick="window.location.href='/trafico'">Ir a Tráfico</button>

    <script type="text/javascript">
    
        var socket = io.connect('http://' + document.domain + ':' + location.port);
    
        socket.on('connect', function() {
            console.log("Conectado al servidor index");
        });
    
        socket.on('info_update', function(data) {
            console.log("Recibido:", data);  // Para depuración
            
            // Limpiar el contenido previo
            document.getElementById('informacion').innerHTML = '';

            // Iterar sobre el diccionario de UEs
            for (const imsi in data.ues) {
                if (data.ues.hasOwnProperty(imsi)) {
                    const ue = data.ues[imsi];
                    const html = '<li>IP: ' + ue.ip + '</li>' +
                                '<li>IMSI: ' + imsi + '</li>' +
                                '<li>APN: ' + ue.apn + '</li> <br>';

                    // Agregar la información de cada UE al elemento 'informacion'
                    document.getElementById('informacion').innerHTML += html;
                }
            }
            // Mostrar el número total de UEs
            document.getElementById('num_ues').innerHTML = 'Número de UEs: ' + data.num_ues;
        });
        
    </script>
{%endblock%}


